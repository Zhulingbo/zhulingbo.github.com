(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){"use strict";function i(t){this._frameRate=t,this.clips=[]}function e(i,s){return this instanceof e?(this.el=i,this.$el=t(i),this.$dispatcher=t("<div />"),this._settings=t.extend(!0,{},this._settings,s),this.totalFrames=this._settings.totalFrames,this.frameRate=this._settings.frameRate,this.layout=this._settings.layout,this.frameWidth=this._settings.frameWidth||this.$el.width()+parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),this.frameHeight=this._settings.frameHeight||this.$el.height()+parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10),this._validateInitialInput(),this._frames=this._getFramePositions(),void 0):new e(i,s)}i.prototype={clips:void 0,_frameRate:void 0,_timeout:void 0,register:function(t){this.clips.push(t),1===this.clips.length&&this._start()},unregister:function(t){for(var i=this.clips,e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&this._stop()},_start:function(){this._timeout=setTimeout(t.proxy(this._update,this),1e3/this._frameRate)},_stop:function(){clearTimeout(this._timeout),delete this._timeout},_update:function(){for(var i,e=this.clips,s=e.length-1;s>=0;s--)i=e[s],1===i.currentDirection?i.nextFrame():i.prevFrame(),(i.currentFrame===i._frameToStopAt||i._hasStopAt(i.currentFrame))&&i.stop();this._timeout=setTimeout(t.proxy(this._update,this),1e3/this._frameRate)}};var s=function(){function t(t){var e=t.frameRate;s[e]instanceof i||(s[e]=new i(e)),s[e].register(t)}function e(t){var e=t.frameRate,r=s[e];r instanceof i&&(r.unregister(t),1>r.clips.length&&delete s[e])}var s={};return{register:t,unregister:e}}();return e.Event={ENTER_FRAME:"enterFrame",PLAYING:"playing",STOPPED:"stopped"},e.prototype={el:void 0,$el:void 0,$dispatcher:void 0,totalFrames:void 0,frameRate:void 0,currentFrame:1,currentDirection:1,isPlaying:!1,layout:void 0,_timeout:void 0,_frameToStopAt:void 0,_frames:[],_settings:{totalFrames:void 0,frameRate:30,stops:[],layout:"horizontal",frameWidth:void 0,frameHeight:void 0},stops:function(i){if(i!==void 0){if(!(i instanceof Array))throw Error('TypeError: If provided, argument "stops" must be an array.');this._settings.stops=i}return t.extend(!0,[],this._stops)},gotoAndPlay:function(t){this._validateFrameInput(t),this.stop(),this.currentFrame=t,this._showFrame(t),this.play()},gotoAndStop:function(t){this._validateFrameInput(t),this.currentFrame=t,this._showFrame(t),this.stop()},gotoAndRewind:function(t){this._validateFrameInput(t),this.stop(),this.currentFrame=t,this._showFrame(t),this.rewind()},playtoAndStop:function(t){this._validateFrameInput(t),this.play(t,1)},rewindtoAndStop:function(t){this._validateFrameInput(t),this.play(t,-1)},nextFrame:function(){this.currentFrame<this.totalFrames?this.currentFrame+=1:this.currentFrame=1,this._showFrame(this.currentFrame)},prevFrame:function(){this.currentFrame>1?this.currentFrame-=1:this.currentFrame=this.totalFrames,this._showFrame(this.currentFrame)},play:function(t,i){i=-1===i?-1:1,this.isPlaying&&i!==this.currentDirection&&this.stop(),this._frameToStopAt=t,this.currentDirection=i,this.isPlaying||(s.register(this),this.isPlaying=!0,this.$dispatcher.triggerHandler(e.Event.PLAYING,this))},rewind:function(){this.play(void 0,-1)},stop:function(){this.isPlaying&&(s.unregister(this),this.isPlaying=!1,this.$dispatcher.triggerHandler(e.Event.STOPPED,this))},_showFrame:function(t){this.$el.css("background-position",this._frames[t-1]),this.$dispatcher.triggerHandler(e.Event.ENTER_FRAME,this)},_hasStopAt:function(t){for(var i=this._settings.stops.length-1;i>=0;--i)if(this._settings.stops[i]===t)return!0;return!1},_getFramePositions:function(){var t,i,e=[],s=(this.$el.css("background-position")||this.$el.css("backgroundPositionX")+" "+this.$el.css("backgroundPositionY")).split(" "),r=0,n=this.totalFrames;if("horizontal"===this._settings.layout)for(i=s[1];n>r;r++)t=-r*this.frameWidth+"px",e.push(t+" "+i);else for(t=s[0];n>r;r++)i=-r*this.frameHeight+"px",e.push(t+" "+i);return e},_validateFrameInput:function(t){if("number"!=typeof t)throw Error('Argument Error: argument "frame" must be a number.');if(1>t||t>this.totalFrames)throw Error('Argument Error: argument "frame" is out of bounds.')},_validateInitialInput:function(){if("vertical"!==this._settings.layout&&"horizontal"!==this._settings.layout)throw Error('options property "layout" must be either "horizontal" or "vertical".');if(isNaN(parseInt(this.frameRate,10)))throw Error('options property "frameRate" must be parsable as an integer.');if("number"!=typeof this.totalFrames)throw Error('options proberty "totalFrames" must be a number');if("horizontal"===this._settings.layout&&isNaN(this.frameWidth))throw Error("this.frameWidth is not a number. Make sure this.$el.width() is a Number when we instantiate or pass an explicit value in options.");if("vertical"===this._settings.layout&&isNaN(this.frameHeight))throw Error("this.frameHeight is not a number. Make sure this.$el.height() is a Number when we instantiate or pass an explicit value in options.")}},t.fn.spriteClip=function(i){return this.each(function(){t.data(this,"spriteClip")||t(this).data("spriteClip",new e(this,i))})},window.SpriteClip=e});